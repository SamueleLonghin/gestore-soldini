{% macro render_table(table) %}

<div class="table-responsive">
    <table class="table table-striped align-middle">
        <thead>
            <tr>
                {% for col in table.columns %}
                <th>{{ col.label }}</th>
                {% endfor %}
                {% if table.actions %}<th>Azioni</th>{% endif %}
            </tr>
        </thead>
        <tbody>
            {% for row in table.rows %}
            <form method="post" action="{{ table.form_action }}">
                <input type="hidden" name="row_id" value="{{ row.id }}">
                <tr>
                    {% for field in row.fields %}
                    <td {% if row.click_url %} onclick="window.location='{{ row.click_url }}'" style="cursor:pointer" {%
                        endif %}>
                        {% if field.type.startswith("link-") %}
                        <a href="{{ row.id }}" target="_blank">{{ field.value }}</a>

                        {% elif field.type == "options" %}
                        {{ field.value }}
                        {% if field.editable %}
                        <select name="{{ field.key }}"
                            class="form-select form-select-sm collapse mt-2 collapse-modifica-{{ row.id }}">
                            {% for opt in field.extra.split('|') %}
                            <option value="{{ opt }}" {% if opt==field.value %}selected{% endif %}>{{ opt }}</option>
                            {% endfor %}
                        </select>
                        {% endif %}

                        {% elif field.type == "widget" %}

                        {{ table.widgets[field.extra](row.raw) }}
                        {% if field.editable %}
                        <div class="collapse mt-2 collapse-modifica-{{ row.id }}">
                            <input type="{{ field.type }}" name="{{ field.key }}" class="form-control form-control-sm"
                                value="{{ field.value }}">
                        </div>
                        {% endif %}
                        {% elif field.type == "prerender-widgets" %}

                        {{ field.value | safe }}
                        {% if field.editable %}
                        <div class="collapse mt-2 collapse-modifica-{{ row.id }}">
                            <input type="{{ field.type }}" name="{{ field.key }}" class="form-control form-control-sm"
                                value="{{ field.value }}">
                        </div>
                        {% endif %}

                        {% else %}
                        {{ field.value }}
                        {% if field.editable %}
                        <div class="collapse mt-2 collapse-modifica-{{ row.id }}">
                            <input type="{{ field.type }}" name="{{ field.key }}" class="form-control form-control-sm"
                                value="{{ field.value }}">
                        </div>
                        {% endif %}
                        {% endif %}
                    </td>
                    {% endfor %}

                    {% if table.actions %}
                    <td>
                        {% for action in table.actions %}
                        <a href="{{ action.url.format(**row.raw) }}" class="btn btn-sm {{ action.class }}">{{
                            action.label | safe }}</a>
                        {% endfor %}
                        {% if row.fields | selectattr("editable") | list %}
                        <span class="ms-1" role="button" data-bs-toggle="collapse"
                            data-bs-target=".collapse-modifica-{{ row.id }}">
                            <i class="bi bi-pencil"></i>
                        </span>
                        <div class="collapse mt-2 collapse-modifica-{{ row.id }}">
                            <input type="submit" value="Salva Modifiche" class="form-control form-control-sm">
                        </div>
                        {% endif %}
                    </td>
                    {% endif %}
                </tr>
            </form>
            {% endfor %}
        </tbody>
    </table>
</div>

{% endmacro %}